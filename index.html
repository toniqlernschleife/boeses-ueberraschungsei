<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Das Ei der Ungeb√ºhr</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Almendra:wght@400;700&display=swap');

        body {
            font-family: 'Almendra', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            background: #d3d3d3 url('https://www.transparenttextures.com/patterns/asfalt-dark.png');
            color: #2c3e50;
            overflow-x: hidden;
        }

        h1 {
            color: #4a2c1a;
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .main-content {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            max-width: 1400px;
            width: 100%;
            position: relative;
        }

        .target-area {
            flex: 0 0 650px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        #targetContainer {
            position: relative;
            width: 650px;
            height: 160px;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 20px 10px;
            background: #e3d5b8 url('https://www.transparenttextures.com/patterns/beige-paper.png');
            border: 8px solid #5d4037;
            border-radius: 15px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2), 0 10px 20px rgba(0,0,0,0.5);
            margin-top: 150px;
        }

        .target-cup {
            flex: 1;
            margin: 0 5px;
            height: 90px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 32px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.4);
            text-shadow: 1px 1px 2px black;
            border: 1px solid rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
        }

        #egg {
            position: absolute;
            width: 40px;
            height: 50px;
            background-color: #fdf5e6;
            border-radius: 50% 50% 50% 50% / 65% 65% 35% 35%;
            border: 2px solid #d4c4a8;
            opacity: 0;
            z-index: 9999;
            pointer-events: none;
            transform-origin: center center;
        }

        #bird {
            position: absolute;
            top: -20px;
            right: -250px;
            font-size: 130px;
            z-index: 10000;
            opacity: 0;
        }

        .bird-flying { animation: fly-across 5s linear forwards; }
        @keyframes fly-across {
            0% { opacity: 1; transform: translateX(0); }
            100% { opacity: 1; transform: translateX(calc(-100vw - 800px)); }
        }

        .splash { animation: splash-anim 0.6s ease-out forwards; }
        @keyframes splash-anim {
            0% { opacity: 1; transform: scale(1); }
            40% { 
                opacity: 1; 
                transform: scale(3.5); 
                background: radial-gradient(circle, #f1c40f 35%, #ffffff 38%); 
                border: none; 
                border-radius: 40% 60% 50% 55%; 
                box-shadow: 0 0 15px rgba(255,255,255,0.8);
            }
            100% { opacity: 0; transform: scale(0); }
        }

        .sanction-list-container {
            flex: 1;
            padding: 30px;
            background: #f4e9d5 url('https://www.transparenttextures.com/patterns/beige-paper.png');
            border: 5px solid #5d4037;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            min-width: 550px;
        }

        ul { list-style: none; padding: 0; margin: 0; }

        .sanc-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            font-size: 1.5rem;
            border-bottom: 2px dashed #8b5a2b;
            font-weight: bold;
            color: #2c1a0e;
        }

        .sanc-text { flex-grow: 1; margin-right: 15px; }
        .sanc-controls { display: flex; gap: 15px; }

        .icon-btn { cursor: pointer; font-size: 1.5rem; transition: transform 0.1s; }
        .icon-btn:hover { transform: scale(1.3); }

        .highlighted {
            background-color: #e3d5b8 !important;
            border-left: 12px solid #8b5a2b !important;
            padding-left: 15px !important;
        }

        .list-footer { display: flex; justify-content: center; gap: 50px; margin-top: 25px; }

        #spinButton {
            margin-top: 30px;
            padding: 15px 50px;
            font-family: 'Almendra', serif;
            font-size: 30px;
            cursor: pointer;
            background-color: #8b5a2b;
            color: white;
            border: none;
            border-radius: 10px;
            box-shadow: 0 6px #5d4037;
            font-weight: bold;
        }
        #spinButton:active { transform: translateY(4px); box-shadow: 0 2px #5d4037; }

        #blackout {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: black;
            display: none;
            z-index: 20000;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: white;
            padding: 50px;
        }
        #blackout.active { display: flex; }
        #blackout-text { font-size: 4.5rem; font-weight: bold; text-shadow: 0 0 20px rgba(255,255,255,0.5); }
    </style>
</head>
<body>

    <h1>ü•ö Das Ei der Ungeb√ºhr ü•ö</h1>

    <div class="main-content">
        <div id="bird">ü¶Ö</div>
        <div id="egg"></div>
        
        <div class="target-area">
            <div id="targetContainer"></div>
            
            <label style="margin-top:25px; font-weight:bold; cursor:pointer; font-size: 1.3rem;">
                <input type="checkbox" id="toggleOption7"> (7) Eintrag in das Hausaufgabenheft
            </label>

            <button id="spinButton">Das Urteil vollstrecken</button>
        </div>

        <div class="sanction-list-container">
            <h2 style="font-size: 2.2rem; margin-top: 0; border-bottom: 3px solid #8b5a2b; padding-bottom: 10px;">Das Ablass-Register</h2>
            
            <ul id="sanctionList"></ul>

            <div class="list-footer">
                <span class="icon-btn" id="addBtn" title="Ma√ünahme hinzuf√ºgen" style="font-size: 3rem;">‚ûï</span>
                <span class="icon-btn" id="resetBtn" title="Alles zur√ºcksetzen" style="font-size: 3rem;">üîÑ</span>
            </div>
        </div>
    </div>

    <div id="blackout">
        <div id="blackout-text"></div>
    </div>

    <script>
        const aCtx = new (window.AudioContext || window.webkitAudioContext)();
        const colors = ["#d4c4a8", "#bfae91", "#a68d71", "#8b7355", "#6d5a42", "#4e3f31", "#2f2f2f"];

        const defaultSanctions = [
            "Joker - Freie Wahl",
            "Entschuldigungskarte an die Klasse",
            "Zwei Tage Stuhl- und Tafeldienst",
            "Unterrichtsinhalt in Gedicht zusammenfassen (2 Strophen √° 4 Verse)",
            "Quiz aus 8 Fragen zum Unterrichtsinhalt",
            "A4-Seite Reflexion bez√ºglich Fehlverhalten"
        ];

        let sanctions = [];
        let option7Active = false;

        function playPlopp() {
            const t = aCtx.currentTime;
            const o = aCtx.createOscillator(); const g = aCtx.createGain();
            o.type = 'sine'; o.frequency.setValueAtTime(180, t);
            o.frequency.exponentialRampToValueAtTime(40, t + 0.15);
            g.gain.setValueAtTime(0.4, t); g.gain.linearRampToValueAtTime(0, t + 0.15);
            o.connect(g).connect(aCtx.destination); o.start(t); o.stop(t + 0.15);
        }

        function playDeepBell() {
            // Verbesserter Glockensound mit Obert√∂nen
            const freqs = [55, 110, 165, 233.08, 311.13]; 
            [0, 2.8].forEach(delay => {
                const t = aCtx.currentTime + delay;
                freqs.forEach((f, i) => {
                    const o = aCtx.createOscillator(); const g = aCtx.createGain();
                    o.type = i === 0 ? 'sine' : 'triangle';
                    o.frequency.setValueAtTime(f, t);
                    g.gain.setValueAtTime(0, t);
                    g.gain.linearRampToValueAtTime(i === 0 ? 0.5 : 0.2, t + 0.1);
                    g.gain.exponentialRampToValueAtTime(0.0001, t + 6);
                    o.connect(g).connect(aCtx.destination); o.start(t); o.stop(t + 6);
                });
            });
        }

        function redraw() {
            const list = document.getElementById('sanctionList');
            const targetContainer = document.getElementById('targetContainer');
            list.innerHTML = ''; targetContainer.innerHTML = '';

            sanctions.forEach((text, i) => {
                const num = i + 1;
                const cup = document.createElement('div');
                cup.className = 'target-cup';
                cup.style.backgroundColor = colors[i % colors.length];
                cup.innerHTML = num;
                targetContainer.appendChild(cup);

                const li = document.createElement('li');
                li.className = 'sanc-item';
                li.id = `sanc-row-${num}`;
                li.innerHTML = `
                    <div class="sanc-text">${num}) ${text}</div>
                    <div class="sanc-controls">
                        <span class="icon-btn edit-trigger" data-idx="${i}">üìú</span>
                        <span class="icon-btn delete-trigger" data-idx="${i}">üóëÔ∏è</span>
                    </div>
                `;
                list.appendChild(li);
            });

            if (option7Active) {
                const num = sanctions.length + 1;
                const cup = document.createElement('div');
                cup.className = 'target-cup';
                cup.style.backgroundColor = "#555";
                cup.innerHTML = num;
                targetContainer.appendChild(cup);

                const li = document.createElement('li');
                li.className = 'sanc-item';
                li.id = `sanc-row-${num}`;
                li.innerHTML = `<div class="sanc-text">${num}) Eintrag in das Hausaufgabenheft</div>`;
                list.appendChild(li);
            }

            document.querySelectorAll('.edit-trigger').forEach(btn => {
                btn.onclick = function() {
                    const idx = this.getAttribute('data-idx');
                    const newVal = prompt("Ma√ünahme umbenennen:", sanctions[idx]);
                    if (newVal !== null && newVal !== "") { sanctions[idx] = newVal; saveAndRedraw(); }
                };
            });

            document.querySelectorAll('.delete-trigger').forEach(btn => {
                btn.onclick = function() {
                    const idx = this.getAttribute('data-idx');
                    if (confirm("L√∂schen?")) { sanctions.splice(idx, 1); saveAndRedraw(); }
                };
            });
        }

        function saveAndRedraw() {
            localStorage.setItem('sanc_v11_final', JSON.stringify(sanctions));
            redraw();
        }

        document.getElementById('addBtn').onclick = () => {
            const newVal = prompt("Neue Ma√ünahme:");
            if (newVal) { sanctions.push(newVal); saveAndRedraw(); }
        };

        document.getElementById('resetBtn').onclick = () => {
            if (confirm("Reset?")) { sanctions = [...defaultSanctions]; saveAndRedraw(); }
        };

        document.getElementById('toggleOption7').onchange = (e) => {
            option7Active = e.target.checked; redraw();
        };

        document.getElementById('spinButton').onclick = () => {
            if(aCtx.state === 'suspended') aCtx.resume();
            const btn = document.getElementById('spinButton');
            btn.disabled = true;
            document.querySelectorAll('.sanc-item').forEach(l => l.classList.remove('highlighted'));

            const bird = document.getElementById('bird');
            const egg = document.getElementById('egg');
            
            let currentList = [...sanctions];
            if (option7Active) currentList.push("Eintrag in das Hausaufgabenheft");
            
            const finalIdx = Math.floor(Math.random() * currentList.length);
            const cups = document.querySelectorAll('.target-cup');
            const targetCup = cups[finalIdx];
            const targetRect = targetCup.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            
            const birdStartX = window.innerWidth + 250;
            const targetCenterX = targetRect.left + (targetRect.width / 2);
            const dropDelay = ((birdStartX - targetCenterX) / (window.innerWidth + 800)) * 5000;

            bird.style.opacity = 1; bird.classList.add('bird-flying');

            setTimeout(() => {
                egg.classList.remove('splash');
                egg.style.background = "#fdf5e6";
                egg.style.opacity = 1;
                egg.style.transition = "none";
                egg.style.left = (targetCenterX - 20) + "px";
                egg.style.top = "60px"; 
                
                setTimeout(() => {
                    egg.style.transition = "top 0.4s ease-in";
                    // Zielpunkt: 15px h√∂her als die exakte Mitte des Bechers
                    const targetCenterY = targetRect.top + (targetRect.height / 2) - bodyRect.top;
                    egg.style.top = (targetCenterY - 40) + "px"; 

                    setTimeout(() => {
                        playPlopp();
                        egg.classList.add('splash');

                        setTimeout(() => {
                            const blackout = document.getElementById('blackout');
                            document.getElementById('blackout-text').textContent = currentList[finalIdx];
                            blackout.classList.add('active');
                            playDeepBell();

                            setTimeout(() => {
                                blackout.classList.remove('active');
                                document.getElementById(`sanc-row-${finalIdx + 1}`).classList.add('highlighted');
                                btn.disabled = false;
                            }, 5000);
                        }, 500);
                    }, 400);
                }, 50);
            }, dropDelay);

            setTimeout(() => { bird.classList.remove('bird-flying'); bird.style.opacity = 0; }, 5200);
        };

        const stored = localStorage.getItem('sanc_v11_final');
        sanctions = stored ? JSON.parse(stored) : [...defaultSanctions];
        redraw();
    </script>
</body>
</html>
