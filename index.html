<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√∂ses √úberraschungs-Ei</title>
    <style>
        /* --- 1. Allgemeine Styles mit neuem Hintergrund --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            /* NEUER HINTERGRUND: Himmelblau zu Beige Gradient */
            background: linear-gradient(to bottom, #87CEEB 0%, #fdf5e6 80%);
            background-attachment: fixed; /* Damit der Gradient beim Scrollen stehen bleibt */
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5rem;
            font-weight: 600;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5); /* Leichter Schatten f√ºr bessere Lesbarkeit auf Blau */
        }

        .main-content {
            display: flex;
            gap: 50px;
            align-items: flex-start;
            max-width: 1200px;
            margin: 0 auto;
            position: relative; 
        }

        /* --- 2. Zielscheibe / Eier-Simulation --- */
        .target-area {
            flex: 0 0 650px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; 
        }

        #targetContainer {
            position: relative;
            width: 650px;
            height: 150px;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            padding: 20px 0;
            /* Hintergrund leicht transparent machen, damit der Boden durchscheint */
            background-color: rgba(255, 255, 255, 0.8);
            border: 4px solid #34495e;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            margin-top: 100px; 
        }

        .target-cup {
            flex-grow: 1; 
            margin: 0 5px; 
            min-width: 30px; 
            max-width: 100px;
            height: 80px;
            border-radius: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s;
            cursor: default;
            position: relative;
        }
        
        /* Das Ei (Vordergrund) */
        #egg {
            position: absolute;
            width: 30px;
            height: 30px;
            background-color: #fff;
            border-radius: 50%;
            border: 2px solid #ccc;
            opacity: 0;
            transition: none;
            font-size: 20px;
            line-height: 25px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            z-index: 1000; 
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Der Vogel (Vordergrund) */
        #bird {
            position: absolute;
            top: 20px; 
            right: 0; 
            font-size: 50px;
            z-index: 999; 
            opacity: 0;
            transform: scaleX(1); 
        }

        /* CSS Keyframes f√ºr den garantierten Flug von Rechts nach Links */
        @keyframes fly-across {
            0% { 
                opacity: 1;
                transform: translateX(0) scaleX(1); 
            }
            100% { 
                opacity: 1;
                transform: translateX(calc(-100vw - 200px)) scaleX(1); 
            }
        }
        
        .bird-flying {
            animation: fly-across 5s linear forwards; 
        }
        
        /* Die Animation f√ºr den Einschlag */
        .splash {
            animation: splash-anim 0.4s ease-out forwards;
        }

        @keyframes splash-anim {
            0% { opacity: 1; transform: scale(1); background-color: #fff; }
            50% { opacity: 0.8; transform: scale(2); background-color: #f1c40f; }
            100% { opacity: 0; transform: scale(0); }
        }


        /* --- 3. Button, Toggle & Ergebnis --- */
        #spinButton {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 24px;
            cursor: pointer;
            background-color: #c0392b; 
            color: white;
            border: none;
            border-radius: 10px;
            box-shadow: 0 6px #a03125;
            transition: all 0.1s;
            font-weight: bold;
        }

        #spinButton:active {
            box-shadow: 0 0 #a03125;
            transform: translateY(6px);
        }

        #spinButton:disabled {
            background-color: #bdc3c7;
            box-shadow: 0 4px #95a5a6;
            cursor: not-allowed;
        }

        #result {
            margin-top: 30px;
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            min-height: 40px;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            background-color: rgba(255, 255, 255, 0.5); /* Leicht transparenter Hintergrund f√ºr Lesbarkeit */
        }

        /* Toggle Container f√ºr Option 6 */
        .option-toggle {
            margin-top: 30px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #3498db;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            color: #2c3e50;
            cursor: pointer;
        }
        .option-toggle input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        /* --- 4. Ma√ünahmenliste am Rand --- */
        .sanction-list-container {
            flex: 1;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.95); /* Leicht transparent */
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            min-width: 350px;
        }

        .sanction-list-container h2 {
            margin-top: 0;
            border-bottom: 2px solid #ddd;
            padding-bottom: 10px;
            color: #3498db;
        }

        .sanction-list-container ol {
            list-style: none;
            padding: 0;
        }

        .sanction-list-container li {
            padding: 10px 0;
            margin-bottom: 8px;
            font-size: 1.1rem;
            border-bottom: 1px dashed #eee;
            transition: background-color 0.2s;
            color: #555;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .sanction-list-container li.highlighted {
            background-color: #ffeaa7;
            border-left: 5px solid #f39c12;
            font-weight: bold;
            color: #2c3e50;
            padding-left: 15px;
        }
        
        .sanction-list-container li span.number {
            font-weight: bold;
            color: #3498db;
            margin-right: 5px;
        }

        /* L√∂sch-Button */
        .delete-sanction, #editSanctionsButton {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        .delete-sanction:hover, #editSanctionsButton:hover {
            opacity: 1;
        }
        .sanction-text {
            flex-grow: 1;
        }

        /* --- 5. Editor Modal & Reset --- */
        #editorContainer {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #ecf0f1;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        #editorContainer input[type="text"] {
            width: calc(100% - 100px);
            padding: 10px;
            margin-right: 10px;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
        }
        #editorContainer button {
            padding: 10px 15px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #editorContainer button:hover {
            background-color: #27ae60;
        }
        .edit-controls {
            margin-top: 10px;
            display: flex;
            justify-content: space-between; 
            align-items: center;
        }
        .edit-controls button {
            margin-left: 10px;
            padding: 8px 20px;
        }
        #closeEditorButton {
            background-color: #95a5a6;
        }
        #closeEditorButton:hover {
            background-color: #7f8c8d;
        }
        #resetButton {
            background-color: #e74c3c;
            color: white;
            padding: 8px 20px;
        }
        #resetButton:hover {
            background-color: #c0392b;
        }

    </style>
</head>
<body>
    <h1>B√∂ses √úberraschungs-Ei ü•ö</h1>

    <div class="main-content">
        <div id="bird">ü¶Ö</div>
        <div id="egg">ü•ö</div>
        
        <div class="target-area">
            <div id="targetContainer">
                </div>
            
            <label class="option-toggle">
                <input type="checkbox" id="toggleOption6">
                (6) Eintrag in das Hausaufgabenheft
            </label>

            <button id="spinButton">Vogel startet...</button>
        </div>

        <div class="sanction-list-container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2>M√∂gliche Ma√ünahmen</h2>
                <button id="editSanctionsButton">Ma√ünahmen bearbeiten</button>
            </div>
            
            <div id="editorContainer" style="display: none;">
                <h3>Ma√ünahme hinzuf√ºgen</h3>
                <input type="text" id="newSanctionText" placeholder="Neue Ma√ünahme hier eingeben...">
                <button id="addSanctionButton">Hinzuf√ºgen</button>
                <div class="edit-controls">
                    <button id="resetButton">Auf Standard zur√ºcksetzen</button>
                    <button id="closeEditorButton">Schlie√üen</button>
                </div>
            </div>
            
            <ol id="sanctionList">
                </ol>
            <div id="result">Bereit...</div>
        </div>

    </div>

    <audio id="fartAudio" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" preload="auto"></audio> 
    <audio id="bammAudio" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-11.mp3" preload="auto"></audio>
    
    <script>
        // DIE STANDARD-MASSNAHMEN (1-5)
        const defaultSanctions = [
            { id: 1, text: "A4-Seite Reflexion bez√ºglich Fehlverhalten verfassen", color: "#e74c3c" },
            { id: 2, text: "Entschuldigungskarte an die Klasse", color: "#f39c12" },
            { id: 3, text: "2 Tage Tafel- und Stuhl-hoch-stell-Dienst", color: "#3498db" },
            { id: 4, text: "Den Inhalt der Unterrichtsstunde in einem Gedicht (3 Strophen √° 4 Verse) zusammenfassen", color: "#1abc9c" },
            { id: 5, text: "Ein Quiz aus mindestens 8 Fragen zum Inhalt der heutigen Unterrichtsstunde anfertigen", color: "#9b59b6" }
        ];
        
        // Die Option 6 (wird per Checkbox hinzugef√ºgt/entfernt)
        const option6Sanction = { id: 6, text: "Eintrag in das Hausaufgabenheft", color: "#2ecc71" };
        
        const availableColors = ["#e74c3c", "#f39c12", "#3498db", "#1abc9c", "#9b59b6", "#e67e22", "#34495e", "#27ae60", "#f1c40f"];

        let sanctions = []; 

        const targetContainer = document.getElementById('targetContainer');
        const spinButton = document.getElementById('spinButton');
        const resultDiv = document.getElementById('result');
        const sanctionList = document.getElementById('sanctionList');
        const eggElement = document.getElementById('egg');
        const birdElement = document.getElementById('bird');
        const fartAudio = document.getElementById('fartAudio');
        const bammAudio = document.getElementById('bammAudio');
        const mainContent = document.querySelector('.main-content'); 
        const toggleOption6 = document.getElementById('toggleOption6'); // Checkbox

        const editButton = document.getElementById('editSanctionsButton');
        const editorContainer = document.getElementById('editorContainer');
        const newSanctionText = document.getElementById('newSanctionText');
        const addSanctionButton = document.getElementById('addSanctionButton');
        const closeEditorButton = document.getElementById('closeEditorButton');
        const resetButton = document.getElementById('resetButton');

        
        const FLIGHT_DURATION_MS = 5000; 
        let isAnimating = false;
        let cupElements = []; 

        // --- Verwaltungsfunktionen ---
        function loadSanctions() {
            const storedSanctions = localStorage.getItem('customSanctions');
            if (storedSanctions) {
                sanctions = JSON.parse(storedSanctions);
            } else {
                sanctions = JSON.parse(JSON.stringify(defaultSanctions));
                saveSanctions(); 
            }
            const hasOption6 = sanctions.some(s => s.id === 6 && s.text === option6Sanction.text);
            toggleOption6.checked = hasOption6;
        }

        function saveSanctions() {
            localStorage.setItem('customSanctions', JSON.stringify(sanctions));
        }
        
        function resetSanctionsToDefault() {
            if (confirm("Sind Sie sicher, dass Sie alle gespeicherten Ma√ünahmen l√∂schen und die Standard-Ma√ünahmen (1-5) wiederherstellen m√∂chten?")) {
                localStorage.removeItem('customSanctions');
                sanctions = JSON.parse(JSON.stringify(defaultSanctions));
                saveSanctions();
                toggleOption6.checked = false;
                
                redrawAll();
                alert("Ma√ünahmen wurden zur√ºckgesetzt.");
                closeEditorButton.click(); 
            }
        }

        toggleOption6.addEventListener('change', (e) => {
            if (e.target.checked) {
                if (!sanctions.some(s => s.id === 6)) {
                    sanctions.push(option6Sanction);
                    sanctions.sort((a, b) => a.id - b.id);
                }
            } else {
                sanctions = sanctions.filter(s => s.id !== 6);
            }
            saveSanctions();
            redrawAll();
        });


        function getNextId() {
            const maxId = sanctions.length > 0 ? Math.max(...sanctions.map(s => s.id)) : 0;
            return Math.max(maxId + 1, 7); 
        }

        function addSanction(text) {
            const newId = getNextId();
            const randomColor = availableColors[sanctions.length % availableColors.length];

            sanctions.push({ 
                id: newId, 
                text: text, 
                color: randomColor 
            });
            saveSanctions();
            redrawAll();
        }

        function deleteSanction(idToDelete) {
            if (sanctions.length <= 1) {
                alert("Mindestens eine Ma√ünahme muss vorhanden sein.");
                return;
            }
            sanctions = sanctions.filter(s => s.id !== idToDelete);
            
            if (idToDelete === 6) {
                toggleOption6.checked = false;
            }

            saveSanctions();
            redrawAll();
        }

        function redrawAll() {
            drawTargets();
            drawSanctionList();
            resultDiv.textContent = 'Bereit...';
            resultDiv.style.backgroundColor = 'transparent';
            resultDiv.style.color = '#2c3e50';
            clearHighlight();
        }

        // --- Zeichenfunktionen ---
        function drawTargets() {
            targetContainer.innerHTML = '';
            
            sanctions.forEach((item, index) => {
                const cup = document.createElement('div');
                cup.classList.add('target-cup');
                cup.id = `cup-${item.id}`;
                cup.style.backgroundColor = item.color;
                cup.innerHTML = `<span>${item.id}</span>`;
                targetContainer.appendChild(cup);
            });
            cupElements = Array.from(targetContainer.querySelectorAll('.target-cup'));
        }

        function drawSanctionList() {
            sanctionList.innerHTML = '';
            sanctions.forEach(item => {
                const li = document.createElement('li');
                li.id = `sanc-${item.id}`;
                li.innerHTML = `
                    <span class="sanction-text">
                        <span class="number">${item.id})</span> ${item.text}
                    </span>
                    <button data-id="${item.id}" class="delete-sanction" title="Ma√ünahme l√∂schen">üóëÔ∏è</button>`;
                sanctionList.appendChild(li);
            });

            document.querySelectorAll('.delete-sanction').forEach(button => {
                button.addEventListener('click', (e) => {
                    const id = parseInt(e.target.dataset.id); 
                    deleteSanction(id);
                });
            });
        }
        
        function clearHighlight() {
            document.querySelectorAll('#sanctionList li').forEach(li => li.classList.remove('highlighted'));
            
            if (cupElements.length > 0) {
                 cupElements.forEach(cup => cup.style.transform = 'scale(1)');
                 spinButton.disabled = false;
            } else {
                 targetContainer.innerHTML = '<p style="text-align:center; width: 100%;">Bitte f√ºgen Sie Ma√ünahmen hinzu.</p>';
                 spinButton.disabled = true;
            }

            eggElement.classList.remove('splash');
            eggElement.style.opacity = 0;
            birdElement.classList.remove('bird-flying');
            birdElement.style.opacity = 0;
            birdElement.style.transform = 'scaleX(1) translateX(0)'; 
        }
        
        // --- Sound und Drop Logik ---

        function stopSound(audioElement) {
            audioElement.pause();
            audioElement.currentTime = 0;
        }
        
        function getBirdCurrentX(dropTime) {
            const progress = dropTime / FLIGHT_DURATION_MS;
            const screenWidth = window.innerWidth;
            
            const totalDistanceAnimated = screenWidth + 200; 
            const translationX = -totalDistanceAnimated * progress; 
            const birdViewportX = screenWidth + translationX;
            
            const mainRect = mainContent.getBoundingClientRect();
            return birdViewportX - mainRect.left;
        }


        function dropEgg(finalIndex, dropTime) {
            const FALL_DURATION_MS = 500; 
            const mainRect = mainContent.getBoundingClientRect();
            const targetCup = cupElements[finalIndex]; 

            if (!targetCup) {
                 isAnimating = false;
                 spinButton.disabled = false;
                 return;
            }

            const dropY = targetCup.getBoundingClientRect().top + targetCup.offsetHeight - mainRect.top - 10; 
            const birdCurrentX = getBirdCurrentX(dropTime); 
            
            eggElement.style.transition = 'none';
            eggElement.style.left = `${birdCurrentX + birdElement.offsetWidth / 2 - eggElement.offsetWidth / 2}px`; 
            eggElement.style.top = `${birdElement.offsetTop + birdElement.offsetHeight}px`; 
            eggElement.style.opacity = 1;

            fartAudio.play().catch(e => console.log('Furz-Audio blockiert.'));

            eggElement.style.transition = `top ${FALL_DURATION_MS}ms ease-in`;
            eggElement.style.top = `${dropY}px`; 

            setTimeout(() => {
                stopSound(fartAudio); 
                
                bammAudio.play().catch(e => console.log('BAMM-Audio blockiert.'));
                eggElement.classList.add('splash');
                
                setTimeout(() => {
                    stopSound(bammAudio); 
                    displayResult(finalIndex); 
                    
                }, 400); 

            }, FALL_DURATION_MS);
        }

        function birdFlight() {
            if (isAnimating || sanctions.length === 0) {
                 if (sanctions.length === 0) resultDiv.textContent = 'Fehler: Keine Ma√ünahmen vorhanden!';
                 return;
            }

            isAnimating = true;
            spinButton.disabled = true;
            clearHighlight();
            resultDiv.textContent = 'Der Vogel fliegt langsam von rechts...';
            
            const screenWidth = window.innerWidth;
            
            const numTargets = sanctions.length; 
            const finalIndex = Math.floor(Math.random() * numTargets); 
            const targetCup = cupElements[finalIndex];
            
            const targetX_Viewport = targetCup.getBoundingClientRect().left + targetCup.offsetWidth / 2;
            
            const totalDistanceAnimated = screenWidth + 200; 
            const distanceNeeded = screenWidth - targetX_Viewport + (birdElement.offsetWidth / 2);
            const dropTime = (distanceNeeded / totalDistanceAnimated) * FLIGHT_DURATION_MS;
            
            birdElement.style.opacity = 1;
            birdElement.classList.add('bird-flying');

            setTimeout(() => {
                dropEgg(finalIndex, dropTime);
            }, dropTime);
            
            setTimeout(() => {
                birdElement.style.opacity = 0;
                birdElement.classList.remove('bird-flying');
                birdElement.style.transform = 'scaleX(1) translateX(0)';
            }, FLIGHT_DURATION_MS + 100);
        }

        function displayResult(index) {
            const resultSanction = sanctions[index];
            
            const chosenListItem = document.getElementById(`sanc-${resultSanction.id}`);
            const chosenCup = cupElements[index];
            
            if (chosenListItem) chosenListItem.classList.add('highlighted');
            if (chosenCup) chosenCup.style.transform = 'scale(1.05)';

            resultDiv.textContent = `Gew√§hlte Ma√ünahme: (${resultSanction.id}) - ${resultSanction.text.split(',')[0]}`;
            resultDiv.style.backgroundColor = resultSanction.color + '33';
            resultDiv.style.color = resultSanction.color;

            setTimeout(() => {
                isAnimating = false;
                spinButton.disabled = false;
            }, 1000); 
        }

        // --- Initialisierung und Event Listener ---
        document.addEventListener('DOMContentLoaded', () => {
            loadSanctions();
            redrawAll();
            spinButton.addEventListener('click', birdFlight);
            
            editButton.addEventListener('click', () => {
                editorContainer.style.display = 'block';
                editButton.style.display = 'none';
                spinButton.disabled = true;
            });
            
            closeEditorButton.addEventListener('click', () => {
                editorContainer.style.display = 'none';
                editButton.style.display = 'block';
                spinButton.disabled = false;
                redrawAll(); 
            });

            addSanctionButton.addEventListener('click', () => {
                const text = newSanctionText.value.trim();
                if (text) {
                    addSanction(text);
                    newSanctionText.value = ''; 
                } else {
                    alert("Bitte geben Sie einen Text f√ºr die neue Ma√ünahme ein.");
                }
            });
            
            newSanctionText.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    addSanctionButton.click();
                }
            });

            resetButton.addEventListener('click', resetSanctionsToDefault);
        });

    </script>
</body>
</html>